<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>  AI CHAT  </title>
  <style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      background:linear-gradient(135deg,#1a1a2e,#16213e,#0f3460);
      color:#fff;height:100%;
    }
    .container {display:flex;height:100vh;position:relative;}
    .sidebar {
      width:280px;background:rgba(26,26,46,0.95);backdrop-filter:blur(10px);
      border-right:1px solid rgba(139,69,255,0.3);padding:15px;overflow-y:auto;
      height:100%;transition:transform .3s ease;z-index:1000;
    }
    .sidebar h2 {color:#8b45ff;font-size:1.3rem;margin-bottom:15px;}
    .model-btn {
      width:100%;padding:12px 15px;margin-bottom:8px;
      background:rgba(139,69,255,0.1);border:1px solid rgba(139,69,255,0.3);
      color:#fff;border-radius:8px;cursor:pointer;transition:all .3s ease;
      font-size:.85rem;text-align:left;
    }
    .model-btn.active {
      background:linear-gradient(45deg,#8b45ff,#b8b8ff);
      box-shadow:0 2px 10px rgba(139,69,255,0.4);
    }
    .chat-area {flex:1;display:flex;flex-direction:column;min-width:0;}
    .chat-header {
      padding:15px 20px;background:rgba(26,26,46,0.9);
      border-bottom:1px solid rgba(139,69,255,0.3);backdrop-filter:blur(10px);
      display:flex;justify-content:center;align-items:center;position:relative;
    }
    .chat-header h1 {color:#8b45ff;font-size:1.4rem;}
    .back-btn {
      position:absolute;left:15px;top:50%;transform:translateY(-50%);
      background:rgba(139,69,255,0.1);border:1px solid rgba(139,69,255,0.3);
      border-radius:8px;padding:6px 12px;cursor:pointer;color:#fff;
      font-size:1.2rem;text-decoration:none;
    }
    .menu-btn {
      position:absolute;right:15px;top:50%;transform:translateY(-50%);
      cursor:pointer;width:28px;height:22px;display:flex;
      flex-direction:column;justify-content:space-between;
    }
    .menu-btn span {
      display:block;height:3px;background:#8b45ff;border-radius:2px;
      transition:.3s;
    }
    .messages-container {
      flex:1;overflow-y:auto;padding:15px;display:flex;flex-direction:column;gap:12px;
    }
    .message {max-width:85%;padding:12px 16px;border-radius:16px;
      word-wrap:break-word;line-height:1.4;opacity:0;transform:translateY(20px);
      animation:slideIn .4s forwards;
    }
    .user-message {
      align-self:flex-end;background:linear-gradient(135deg,#8b45ff,#b8b8ff);
      color:#fff;border-bottom-right-radius:6px;
    }
    .ai-message {
      align-self:flex-start;background:rgba(26,26,46,0.8);
      border:1px solid rgba(139,69,255,0.3);border-bottom-left-radius:6px;
    }
    .typing {font-style:italic;color:#b8b8ff;}
    .dot {display:inline-block; animation:blink 1s infinite;}
    .dot:nth-child(1){animation-delay:0s;}
    .dot:nth-child(2){animation-delay:.2s;}
    .dot:nth-child(3){animation-delay:.4s;}
    @keyframes blink {0%,80%,100%{opacity:0;} 40%{opacity:1;}}
    @keyframes slideIn {to {opacity:1;transform:translateY(0);}}
    .input-container {
      padding:15px;background:rgba(26,26,46,0.95);
      border-top:1px solid rgba(139,69,255,0.3);backdrop-filter:blur(10px);
    }
    .input-row {display:flex;gap:10px;}
    .input-field {
      flex:1;padding:12px 16px;background:rgba(15,52,96,0.3);
      border:1px solid rgba(139,69,255,0.3);border-radius:20px;color:#fff;
      font-size:.9rem;outline:none;
    }
    .send-btn {
      padding:12px 20px;background:linear-gradient(135deg,#8b45ff,#b8b8ff);
      border:none;border-radius:20px;color:#fff;cursor:pointer;
    }
    .send-btn:disabled {opacity:.5;cursor:not-allowed;}
    @media (max-width:768px){
      .sidebar{position:fixed;transform:translateX(-100%);}
      .sidebar.open{transform:translateX(0);}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar" id="sidebar">
      <h2>Pilih Model</h2>
      <button class="model-btn active" data-model="perplexity">Perplexity AI</button>
      <button class="model-btn" data-model="lexerium">Lexerium AI</button>
    </div>
    <div class="chat-area">
      <div class="chat-header">
        <a href="index.html" class="back-btn">«</a>
        <h1>AI Chat</h1>
        <div class="menu-btn" id="menuBtn"><span></span><span></span><span></span></div>
      </div>
      <div class="messages-container" id="messages"></div>
      <div class="input-container">
        <div class="input-row">
          <input type="text" id="userInput" class="input-field" placeholder="Tulis pertanyaan..." />
          <button id="sendBtn" class="send-btn">Kirim</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    const messagesEl = document.getElementById("messages");
    const inputEl = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const modelBtns = document.querySelectorAll(".model-btn");
    const sidebar = document.getElementById("sidebar");
    const menuBtn = document.getElementById("menuBtn");
    let currentModel = "perplexity";

    // pilih model
    modelBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        if (currentModel !== btn.dataset.model) {
          messagesEl.innerHTML = ""; // clear chat kalau ganti model
        }
        modelBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentModel = btn.dataset.model;
        if (window.innerWidth <= 768) sidebar.classList.remove("open");
      });
    });

    // toggle sidebar
    menuBtn.addEventListener("click", () => {
      sidebar.classList.toggle("open");
    });

    function formatMessage(text) {
      text = text.replace(/\n/g, "<br>");
      text = text.replace(/\*(.*?)\*/g, "<b>$1</b>");
      text = text.replace(/_(.*?)_/g, "<i>$1</i>");
      text = text.replace(/~(.*?)~/g, "<s>$1</s>");
      text = text.replace(/(https?:\/\/[^\s]+|[^\s]+\.com[^\s]*)/gi, url => {
        let u = url.startsWith("http") ? url : "https://" + url;
        return `<a href="${u}" target="_blank" style="color:#8b45ff;">${url}</a>`;
      });
      text = text.replace(/@([a-zA-Z0-9_]+)/g,
        `<a href="https://t.me/$1" target="_blank" style="color:#8b45ff;">@$1</a>`);
      return text;
    }

    function addMessage(text, sender) {
      const div = document.createElement("div");
      div.className = "message " + (sender === "user" ? "user-message" : "ai-message");
      div.innerHTML = formatMessage(text);
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function addTypingIndicator() {
      const div = document.createElement("div");
      div.className = "message ai-message typing";
      div.innerHTML = `AI sedang mengetik<span class="dot">.</span><span class="dot">.</span><span class="dot">.</span>`;
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
      return div;
    }

    async function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;
      addMessage(text, "user");
      inputEl.value = "";
      sendBtn.disabled = true;
      const typingDiv = addTypingIndicator();

      try {
        const res = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text, model: currentModel })
        });
        const data = await res.json();
        typingDiv.remove();
        addMessage(data.reply, "ai"); // cukup ambil dari server (sudah ada Model + Jawaban)
      } catch (err) {
        typingDiv.remove();
        addMessage("⚠️ Error: " + err.message, "ai");
      } finally {
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener("click", sendMessage);
    inputEl.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });
  </script>
</body>
</html>
